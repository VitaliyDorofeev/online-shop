(()=>{"use strict";class e{constructor(){this.query=""}async getParams(){try{const e="https://jsproject.webcademy.ru/itemsinfo",n=await fetch(e),a=await n.json();this.params=await a}catch(e){alert("error")}}async getResults(){try{const e=`https://jsproject.webcademy.ru/items${this.query}`,n=await fetch(e),a=await n.json();this.result=await a}catch(e){alert("error")}}}const n={filterSelect:document.getElementsByClassName("filter__dropdown"),filterRooms:document.getElementsByClassName("rooms__checkbox"),filterFields:document.getElementsByClassName("range__input"),filterSubmit:document.getElementsByClassName("filter__show")};function a(e){const a=n.filterSubmit[0];let s;s=e>0?`Показать ${e} объектов`:"Объекты не найдены. Измените условия поиска",a.innerText=s,a.disabled=0===e}function s(e,n){const a=document.querySelector("#listingContainer"),s=`<article class="col-md-4">\n        \x3c!-- card --\x3e\n        <a href="#/item/${e.id}" class="card" data-id="${e.id}">\n            <div class="card__header">\n                <div class="card__title">\n                    ЖК ${e.complex_name}\n                </div>\n                <div class="card__like ${n?"card__like--active":""}">\n                    <i class="fas fa-heart"></i>\n                </div>\n            </div>\n            <div class="card__img">\n                <img src="${e.image}" alt="План квартиры" />\n            </div>\n            <div class="card__desc">\n                <div class="card__price">\n                    <div class="card__price-total">\n                        ${e.price_total} ₽\n                    </div>\n                    <div class="card__price-per-meter">\n                        ${e.price_sq_m} ₽/м2\n                    </div>\n                </div>\n\n                \x3c!-- card__params params --\x3e\n                <div class="card__params params">\n                    <div class="params__item">\n                        <div class="params__definition">\n                            Комнат\n                        </div>\n                        <div class="params__value">${e.rooms}</div>\n                    </div>\n                    <div class="params__item">\n                        <div class="params__definition">\n                            Площадь\n                        </div>\n                        <div class="params__value">${e.square}</div>\n                    </div>\n                </div>\n                \x3c!-- //card__params params --\x3e\n            </div>\n            <div class="card__footer">\n                <div class="card__art">${e.scu}</div>\n                <div class="card__floor">Этаж ${e.floor} из ${e.floors_total}</div>\n            </div>\n        </a>\n        \x3c!-- // card --\x3e\n    </article>`;a.insertAdjacentHTML("beforeend",s)}class t{constructor(e){this.id=e}async getItem(){try{const e=`https://jsproject.webcademy.ru/items/${this.id}`,n=await fetch(e),a=await n.json();this.result=await a}catch(e){alert(e)}}async submitForm(e){const n=await fetch("https://jsproject.webcademy.ru/bidnew",{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(e)}),a=await n.json();this.response=await a}}function i(){document.querySelector(".modal-wrapper").classList.add("none")}class r{constructor(e){this.favsList=e}async getFavs(){const e=this.favsList.toString();if(e){const n=`https://jsproject.webcademy.ru/items?ids=${e}`,a=await fetch(n),s=await a.json();this.cards=await s}}}class c{constructor(){}async getBids(){try{const e="https://jsproject.webcademy.ru/bids",n=await fetch(e),a=await n.json();this.bids=await a}catch(e){alert("Error with getting Bids"),console.log(e)}}}function l(){document.querySelector("#app").innerHTML='<div class="container"><h1>Error</h1></div>'}const d={result:[],emitter:new class{constructor(){this.events={}}emit(e,n){const a=this.events[e];a&&a.forEach((e=>{e.call(null,n)}))}subscribe(e,n){return this.events[e]||(this.events[e]=[]),this.events[e].push(n),()=>{this.events[e]=this.events[e].filter((e=>n!==e))}}},favourites:new class{constructor(){this.favs=[],this.readStorage()}addFav(e){this.favs.push(e),this.saveData()}removeFav(e){const n=this.favs.indexOf(e);this.favs.splice(n,1),this.saveData()}isFav(e){return-1!==this.favs.indexOf(e)}toggleFav(e){this.isFav(e)?this.removeFav(e):this.addFav(e)}saveData(){localStorage.setItem("favs",JSON.stringify(this.favs))}readStorage(){const e=JSON.parse(localStorage.getItem("favs"));e&&(this.favs=e)}}};window.state=d;const o=[{path:"/",component:async function(t){document.querySelector("#app").innerHTML="",await async function(s){s.filter||(s.filter=new e),await s.filter.getParams(),function(e){let n="";e.complexNames.forEach((e=>{n+=`<option value="${e}">ЖК ${e}</option>`}));let a="";e.roomValues.forEach((e=>{a+=`<input\n                    name="rooms"\n                    type="checkbox"\n                    id="${e}"\n                    class="rooms__checkbox"\n                    value="${e}"/>\n                <label for="${e}" class="rooms__btn">${e}</label>`}));const s=` \n    <form id="filter-form" method="GET" class="container p-0">\n    <div class="heading-1">Выбор квартир:</div>\n    <div class="filter">\n        <div class="filter__col">\n            <div class="filter__label">Выбор проекта:</div>\n            <select name="complex" id="" class="filter__dropdown">\n                <option value="all">Все проекты</option>\n                ${n}\n            </select>\n        </div>\n        <div class="filter__col rooms">\n            <div class="filter__label">Комнат:</div>\n            <div class="rooms__wrapper">\n                ${a}                \n            </div>\n        </div>\n        <div class="filter__col">\n            <div class="filter__label">Площадь:</div>\n            <div class="range__wrapper">\n                <label class="range">\n                    <div for="" class="range__label">от</div>\n                    <input\n                        name="sqmin"\n                        min="0"\n                        type="number"\n                        class="range__input"\n                        placeholder="${e.squareMin}"\n                        value="${e.squareMin}"\n                    />\n                    <div class="range__value">м2</div>\n                </label>\n                <label class="range">\n                    <div for="" class="range__label">до</div>\n                    <input\n                        name="sqmax"\n                        min="0"\n                        type="number"\n                        class="range__input"\n                        placeholder="${e.squareMax}"\n                        value="${e.squareMax}"\n                    />\n                    <div class="range__value">м2</div>\n                </label>\n            </div>\n        </div>\n        <div class="filter__col">\n            <div class="filter__label">Стоимость:</div>\n            <div class="range__wrapper">\n                <div class="range">\n                    <label for="" class="range__label">от</label>\n                    <input\n                        type="number"\n                        name="pricemin"\n                        min="0"\n                        class="range__input range__input--price"\n                        placeholder="${e.priceMin}"\n                        value="${e.priceMin}"\n                    />\n                    <div class="range__value">₽</div>\n                </div>\n                <div class="range">\n                    <label for="" class="range__label">до</label>\n                    <input\n                        type="number"\n                        name="pricemax"\n                        min="0"\n                        class="range__input range__input--price"\n                        placeholder="${e.priceMax}"\n                        value="${e.priceMax}"\n                    />\n                    <div class="range__value">₽</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="filter__buttons">\n        <button class="filter__show">Показать объекты</button>\n        <button type="reset" class="filter__reset">Сбросить фильтр</button>\n    </div>\n</form>`;document.querySelector("#app").insertAdjacentHTML("afterbegin",s)}(s.filter.params),await s.filter.getResults(),s.results=s.filter.result,a(s.filter.result.length);const t=document.querySelector("#filter-form");t.addEventListener("change",(async function(e){e.preventDefault(),s.filter.query=function(){const e=new URLSearchParams;"all"!==n.filterSelect[0].value&&e.append(n.filterSelect[0].name,n.filterSelect[0].value);const a=[];Array.from(n.filterRooms).forEach((e=>{""!==e.value&&e.checked&&a.push(e.value)}));const s=a.join(",");""!==s&&e.append("rooms",s),Array.from(n.filterFields).forEach((n=>{""!==n.value&&e.append(n.name,n.value)}));const t=e.toString();return t?"?"+t:""}(),await s.filter.getResults(),s.results=s.filter.result,a(s.filter.result.length)})),t.addEventListener("reset",(async function(){s.filter.query="",await s.filter.getResults(),a(s.filter.result.length),s.results=s.filter.result})),t.addEventListener("submit",(async function(e){e.preventDefault(),s.emitter.emit("event:render-listing",{})}))}(t),function(e){function n(){Array.from(document.getElementsByClassName("card__like")).forEach((n=>{n.addEventListener("click",(n=>{n.preventDefault();const a=n.target.closest(".card").dataset.id;var s;e.favourites.toggleFav(a),s=n.target.closest(".card__like"),e.favourites.isFav(a)?s.classList.add("card__like--active"):s.classList.remove("card__like--active")}))}))}document.querySelector("#app").insertAdjacentHTML("beforeend",'\n        <div class="cards-wrapper">\n            <div class="container p-0 pt-5">\n\n                <div id="listingContainer" class="row">\n\n                </div>\n            </div>\n        </div>'),e.results.forEach((function(n){s(n,e.favourites.isFav(n.id))})),n(),e.emitter.subscribe("event:render-listing",(()=>{document.querySelector("#listingContainer").innerHTML="",e.results.forEach((function(n){s(n,e.favourites.isFav(n.id))})),n()}))}(t)}},{path:"item",component:function(e){document.querySelector("#app").innerHTML="",async function(e){e.singleItem=new t(e.routeParams),await e.singleItem.getItem(),function(e,n){const a=document.querySelector("#app"),s=`<div class="container p-0 pt-5">\n        <div class="heading-1">\n            ${e.title}, ${e.square} м2 за ${e.price_total} ₽\n        </div>\n\n        \x3c!-- object --\x3e\n        <div class="object">\n            \x3c!-- object__photo --\x3e\n            <div class="object__photo">\n                <div class="object__photo-wrapper">\n                    <img src="${e.image}" alt="" />\n                </div>\n            </div>\n            \x3c!-- // object__photo --\x3e\n\n            \x3c!-- object__desc --\x3e\n            <div class="object__desc">\n                <div class="object__desc-sector">\n                    ЖК ${e.complex_name}\n                </div>\n\n                <div class="object__desc-name">\n                    <div class="object__desc-title">\n                        ${e.title}\n                    </div>\n                    <div class="object__desc-art">${e.scu}</div>\n\n                    \x3c!-- Добавить в избранное --\x3e\n                    <button id="addToFavouriteBtn" \n                    class="\n                    button-favourite\n                    ${n?"button-favourite--active":""}\n                        ">\n                        <i class="fas fa-heart"></i>\n                        <span>\n                            ${n?"В избранном":"В избранное"}\n                        </span>\n                    </button>\n\n\n                </div>\n\n                <div class="object__desc-details">\n                    \x3c!-- params --\x3e\n                    <div class="params">\n                        <div class="params__item">\n                            <div class="params__definition">Корпус</div>\n                            <div class="params__value">${e.building}</div>\n                        </div>\n                        <div class="params__item">\n                            <div class="params__definition">Этаж</div>\n                            <div class="params__value">${e.floor}</div>\n                        </div>\n                        <div class="params__item">\n                            <div class="params__definition">Номер</div>\n                            <div class="params__value">${e.flat_number}</div>\n                        </div>\n                        <div class="params__item">\n                            <div class="params__definition">Комнат</div>\n                            <div class="params__value">${e.rooms}</div>\n                        </div>\n                    </div>\n                    \x3c!-- // params --\x3e\n                </div>\n\n                <div class="details">\n                    <div class="details__row">\n                        <div class="details__name">Стоимость</div>\n                        <div\n                            class="details__value details__value--price"\n                        >\n                            ${e.price_total} ₽\n                        </div>\n                    </div>\n                    <div class="details__row">\n                        <div class="details__name">Цена за м2</div>\n                        <div class="details__value">${e.price_sq_m} ₽/м2</div>\n                    </div>\n                    <div class="details__row">\n                        <div class="details__name">Площадь</div>\n                        <div class="details__value">${e.square} м2</div>\n                    </div>\n                </div>\n\n                <button class="button-order">Забронировать</button>\n                \x3c!-- <button class="button-preview">Записаться на просмотр</button> --\x3e\n            </div>\n            \x3c!-- // object__desc --\x3e\n        </div>\n        \x3c!-- // object --\x3e\n    </div>\n\n    <div class="container p-0">\n        <a href="/" class="back-to-results"\n            >← Вернуться к результатам поиска</a\n        >\n    </div>`;a.insertAdjacentHTML("beforeend",s),a.insertAdjacentHTML("beforeend",'<div class="modal-wrapper none">\n        <div class="modal">\n            <div class="modal__header">\n                <div class="modal__title">\n                    Заявка на бронирование\n                </div>\n                <div class="modal__details">\n                    Квартира <span>96</span> в Первом квартале Дом 5\n                    <div class="modal__details-art">ГЕН-112-42</div>\n                </div>\n            </div>\n\n            <form class="modal__form">\n                <div class="modal__form-content">\n                    \x3c!-- formgroup --\x3e\n                    <div class="formgroup">\n                        <label\n                            class="modal__form-input-label"\n                            for="form-phone"\n                        >\n                            Имя\n                        </label>\n                        <input\n                            type="text"\n                            id="form-name"\n                            class="modal__form-input"\n                            placeholder="Введите имя"\n                        />\n                    </div>\n                    \x3c!-- // formgroup --\x3e\n                    \x3c!-- formgroup --\x3e\n                    <div class="formgroup">\n                        <label\n                            class="modal__form-input-label"\n                            for="form-phone"\n                        >\n                            Телефон\n                        </label>\n                        <input\n                            type="text"\n                            id="form-phone"\n                            class="modal__form-input"\n                            placeholder="+7 (XXX) XXX-XX-XX"\n                        />\n                    </div>\n                    \x3c!-- // formgroup --\x3e\n\n                    <div class="formgroup formgroup--checkbox">\n                        <input type="checkbox" id="policy" checked />\n                        <label class="policy-text" for="policy"\n                            >Я согласен на обработку моих персональных\n                            данных. С Политикой в отношении обработки\n                            персональных данных ознакомлен и\n                            согласен.</label\n                        >\n                    </div>\n                </div>\n                <input\n                    class="modal__submit"\n                    type="submit"\n                    value="Отправить заявку"\n                />\n            </form>\n            <button class="modal__close">\n                Закрыть\n            </button>\n        </div>\n    </div>')}(e.singleItem.result,e.favourites.isFav(e.singleItem.id)),document.querySelector(".button-order").addEventListener("click",(()=>{document.querySelector(".modal-wrapper").classList.remove("none")})),document.querySelector(".modal__close").addEventListener("click",(()=>{i()})),document.querySelector(".modal-wrapper").addEventListener("click",(e=>{if(e.target.closest(".modal"))return null;i()})),document.querySelector(".modal__form").addEventListener("submit",(async function(n){n.preventDefault();const a=function(){const e={};return e.name=document.querySelector("#form-name").value,e.phone=document.querySelector("#form-phone").value,e}();await e.singleItem.submitForm(a);const s=e.singleItem.response;"Bid Created"===s.message?(alert("Ваша заявка успешно добавлена!!!"),i(),document.querySelector("#form-name").value="",document.querySelector("#form-phone").value=""):"Bid Not Created"===s.message&&s.errors.forEach((function(e){alert(e)}))})),document.querySelector("#addToFavouriteBtn").addEventListener("click",(function(){e.favourites.toggleFav(e.singleItem.id),function(e){const n=document.querySelector("#addToFavouriteBtn");e?(n.classList.add("button-favourite--active"),n.querySelector("span").textContent="В избранном"):(n.classList.remove("button-favourite--active"),n.querySelector("span").textContent="В избранное")}(e.favourites.isFav(e.singleItem.id))}))}(e)}},{path:"favourites",component:function(){document.querySelector("#app").innerHTML="",async function(e){const n=e.favourites.favs,a=new r(n);var s;await a.getFavs(),s=a.cards,document.querySelector("#app").insertAdjacentHTML("afterbegin",'\n        <div class="container p-0 mb-5">\n            <div class="heading-1">Избранное</div>\n        </div>\n         <div class="cards-wrapper">\n            <div class="container p-0">\n                <div id="cardsHolder" class="row">\n                    \x3c!-- cards will be here --\x3e\n                </div>\n            </div>\n        </div>\n    '),s&&s.forEach((e=>{!function(e){const n=document.querySelector("#cardsHolder"),a=`<article class="col-md-4">\n                        \x3c!-- card --\x3e\n                        <a href="#/item/${e.id}" class="card" data-id="${e.id}">\n                            <div class="card__header">\n                                <div class="card__title">\n                                    ЖК ${e.complex_name}\n                                </div>\n                                <div class="card__like card__like--active">\n                                    <i class="fas fa-heart"></i>\n                                </div>\n                            </div>\n                            <div class="card__img">\n                                <img src="${e.image}" alt="План квартиры" />\n                            </div>\n                            <div class="card__desc">\n                                <div class="card__price">\n                                    <div class="card__price-total">\n                                        ${e.price_total} ₽\n                                    </div>\n                                    <div class="card__price-per-meter">\n                                        ${e.price_sq_m} ₽/м2\n                                    </div>\n                                </div>\n\n                                \x3c!-- card__params params --\x3e\n                                <div class="card__params params">\n                                    <div class="params__item">\n                                        <div class="params__definition">\n                                            Комнат\n                                        </div>\n                                        <div class="params__value">${e.rooms}</div>\n                                    </div>\n                                    <div class="params__item">\n                                        <div class="params__definition">\n                                            Площадь\n                                        </div>\n                                        <div class="params__value">${e.square}</div>\n                                    </div>\n                                </div>\n                                \x3c!-- //card__params params --\x3e\n                            </div>\n                            <div class="card__footer">\n                                <div class="card__art">${e.scu}</div>\n                                <div class="card__floor">Этаж ${e.floor} из ${e.floors_total}</div>\n                            </div>\n                        </a>\n                        \x3c!-- // card --\x3e\n                    </article>`;n.insertAdjacentHTML("beforeend",a)}(e)})),Array.from(document.getElementsByClassName("card__like")).forEach((n=>{n.addEventListener("click",(n=>{n.preventDefault();const a=n.target.closest(".card").dataset.id;var s;e.favourites.toggleFav(a),s=n.target.closest(".card__like"),e.favourites.isFav(a)?s.classList.add("card__like--active"):s.classList.remove("card__like--active")}))}))}(state)}},{path:"bids",component:function(e){document.querySelector("#app").innerHTML="",async function(e){var n;e.bids||(e.bids=new c),await e.bids.getBids(),n=e.bids.bids,document.querySelector("#app").insertAdjacentHTML("afterbegin",'\n            <div class="container p-0 mb-5">\n                <div class="heading-1">Заявки</div>\n            </div>\n            \x3c!-- panels-wrapper --\x3e\n            <div class="panels-wrapper">\n                <div id="bidsHolder" class="container p-0">\n                    \x3c!-- Bids wil be here --\x3e\n                </div>\n            </div>\n            \x3c!-- // panels-wrapper --\x3e '),n.forEach((e=>{!function(e){const n=`\n            <div class="panel panel--no-hover">\n                <div class="panel__bidid">${e.id}</div>\n                <div class="panel__bidname">${e.name}</div>\n                <div class="panel__bidphone">${e.phone}</div>\n            </div>`;document.querySelector("#bidsHolder").insertAdjacentHTML("beforeend",n)}(e)}))}(e)}}];function v(){const e=location.hash.split("/");let n=""===e[0]?"/":e[1];n=""===n?"/":n,d.routeParams=e[2]?e[2]:"";const{component:a=l}=function(e,n){return n.find((function(n){return n.path===e}))}(n,o)||{};a(d)}window.addEventListener("hashchange",v),window.addEventListener("load",v)})();